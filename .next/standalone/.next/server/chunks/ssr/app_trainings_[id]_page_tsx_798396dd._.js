module.exports=[33731,a=>{"use strict";a.s(["default",()=>w],33731);var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(26251),f=a.i(63588),g=a.i(60246),h=a.i(70106);let i=(0,h.default)("clipboard-check",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);var j=a.i(17756),j=j,k=a.i(25015);let l=(0,h.default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var m=a.i(96221),n=a.i(40695),o=a.i(3130),p=a.i(88237),q=a.i(19721),r=a.i(38246),s=a.i(94697),t=a.i(23292);let u=new class{ws=null;reconnectAttempts=0;maxReconnectAttempts=5;reconnectDelay=3e3;heartbeatInterval=null;trainingId=null;onAttendanceUpdate=null;onError=null;constructor(){}connect(a,b,c){if(this.ws?.readyState===WebSocket.OPEN)return void console.log("WebSocket already connected");this.trainingId=a,this.onAttendanceUpdate=b,this.onError=c;try{let a=this.getToken();if(!a)throw Error("No authentication token found");this.ws=new WebSocket(`ws://localhost:8080/ws?token=${a}`),this.ws.onopen=()=>{console.log("WebSocket connection established"),this.reconnectAttempts=0,this.send({type:"PING"}),this.startHeartbeat(),t.toast.success("Connected to real-time attendance system")},this.ws.onmessage=a=>{try{let b=JSON.parse(a.data);this.handleMessage(b)}catch(a){console.error("Error processing WebSocket message:",a)}},this.ws.onclose=a=>{console.log("WebSocket connection closed",a.code,a.reason),this.stopHeartbeat(),1e3!==a.code&&this.reconnectAttempts<this.maxReconnectAttempts&&this.attemptReconnect()},this.ws.onerror=a=>{console.error("WebSocket error:",a),t.toast.error("Connection error. Attempting to reconnect...")}}catch(a){console.error("Failed to connect to WebSocket:",a),this.onError?.("Failed to connect to attendance system")}}handleMessage(a){switch(a.type){case"ATTENDANCE":if(a.data){let b={employeeName:a.data.name,employeeDepartment:a.data.department,createdOn:new Date().toISOString()};this.onAttendanceUpdate?.(b),t.toast.success(`New Attendee: ${b.employeeName}`,{description:`${b.employeeDepartment} department`})}break;case"ERROR":this.onError?.(a.message||"Unknown error occurred"),t.toast.error("Attendance Error",{description:a.message||"Unknown error occurred"});break;case"PONG":break;default:console.log("Unhandled message type:",a.type)}}startHeartbeat(){this.heartbeatInterval=setInterval(()=>{this.ws?.readyState===WebSocket.OPEN&&this.send({type:"PING"})},15e3)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}attemptReconnect(){this.reconnectAttempts++,console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.trainingId&&this.onAttendanceUpdate&&this.onError&&this.connect(this.trainingId,this.onAttendanceUpdate,this.onError)},this.reconnectDelay)}send(a){this.ws?.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(a))}getToken(){return null}disconnect(){this.stopHeartbeat(),this.ws&&(this.ws.close(1e3,"Manual disconnect"),this.ws=null),this.trainingId=null,this.onAttendanceUpdate=null,this.onError=null,this.reconnectAttempts=0}isConnected(){return this.ws?.readyState===WebSocket.OPEN}};var v=a.i(3060);function w(){let a=Number((0,d.useParams)().id),[h,q]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(0),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(1),[E,F]=(0,c.useState)(!0),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(!1);(0,c.useEffect)(()=>(K(),()=>{u.disconnect()}),[a]),(0,c.useEffect)(()=>{h?.status==="in-progress"?P():u.disconnect()},[h?.status,a]);let K=async()=>{try{F(!0);let b=await s.TrainingService.getTrainingSessionById(a);q(b);let c=await s.TrainingService.getAttendanceLogs(a);x(c);let d=await s.TrainingService.getTrainingResponses(a);z(d.length);let e=await s.TrainingService.getTrainingMetrics(b.trainingName);B(e)}catch(a){console.error("Failed to fetch training data:",a),t.toast.error("Failed to load training details. Please try again.")}finally{F(!1)}},L=w?.attendees||[],M=Math.ceil(L.length/5),N=(C-1)*5,O=L.slice(N,N+5),P=()=>{u.isConnected()||u.connect(a.toString(),Q,R)},Q=a=>{x(b=>b?b.attendees.some(b=>b.employeeName===a.employeeName)?b:{...b,attendees:[...b.attendees,{employeeName:a.employeeName,employeeDepartment:a.employeeDepartment,createdOn:a.createdOn}]}:b)},R=a=>{console.error("WebSocket error:",a),t.toast.error("Connection Error",{description:a})},S=async()=>{if(h)try{H(!0),await Promise.all([s.TrainingService.startTrainingSession(h.id),s.TrainingService.updateTrainingSession({id:h.id,status:"in-progress"})]),q(a=>a?{...a,status:"in-progress"}:null),t.toast.success("Training session started successfully!")}catch(a){console.error("Failed to start training session:",a),console.error("Error details:",{message:a?.message,status:a?.status,response:a?.response?.data}),t.toast.error("Failed to start training session",{description:a?.message||"Please try again."})}finally{H(!1)}},T=async()=>{if(h)try{H(!0),u.disconnect(),await Promise.all([s.TrainingService.endTrainingSession(h.id),s.TrainingService.updateTrainingSession({id:h.id,status:"done"})]),q(a=>a?{...a,status:"done"}:null),t.toast.success("Training session ended successfully!")}catch(a){console.error("Failed to end training session:",a),console.error("Error details:",{message:a?.message,status:a?.status,response:a?.response?.data}),t.toast.error("Failed to end training session",{description:a?.message||"Please try again."})}finally{H(!1)}},U=async()=>{if(h)try{await s.TrainingService.exportResponsesZIP(h.id),t.toast.success("Evaluation responses exported successfully!")}catch(a){console.error("Failed to export responses:",a),t.toast.error("Failed to export responses",{description:a?.message||"Please try again."})}};return!h&&E?(0,b.jsx)("div",{className:"p-6 flex items-center justify-center min-h-[400px]",children:(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(m.Loader2,{className:"h-6 w-6 animate-spin"}),(0,b.jsx)("span",{className:"text-lg",children:"Loading training details..."})]})}):h?(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)(r.default,{href:"/trainings",className:"flex items-center text-sm text-muted-foreground mb-4 hover:underline",children:[(0,b.jsx)(j.default,{className:"h-4 w-4 mr-1"}),"Back to Trainings"]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"font-medium",children:"Agenda:"}),(0,b.jsx)("span",{children:h.trainingName})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"font-medium",children:"Facilitator:"}),(0,b.jsx)("span",{children:h.facilitator})]})]}),(()=>{if(!h)return null;let a=h.status;return"upcoming"===a?(0,b.jsxs)("div",{className:"space-x-2",children:[(0,b.jsxs)(n.Button,{variant:"outline",disabled:!0,children:[(0,b.jsx)(f.MessageSquare,{className:"h-4 w-4 mr-2"}),"Take Responses"]}),(0,b.jsxs)(n.Button,{onClick:S,disabled:G,children:[G?(0,b.jsx)(m.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(k.Play,{className:"h-4 w-4 mr-2"}),"Start Session"]})]}):"in-progress"===a?(0,b.jsxs)("div",{className:"space-x-2",children:[(0,b.jsxs)(n.Button,{variant:"outline",onClick:()=>J(!0),children:[(0,b.jsx)(f.MessageSquare,{className:"h-4 w-4 mr-2"}),"Take Responses"]}),(0,b.jsxs)(n.Button,{onClick:T,disabled:G,children:[G?(0,b.jsx)(m.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(l,{className:"h-4 w-4 mr-2"}),"End Session"]})]}):(0,b.jsxs)("div",{className:"space-x-2",children:[(0,b.jsxs)(n.Button,{variant:"outline",onClick:()=>J(!0),children:[(0,b.jsx)(f.MessageSquare,{className:"h-4 w-4 mr-2"}),"Take Responses"]}),(0,b.jsxs)(n.Button,{onClick:U,children:[(0,b.jsx)(e.FileDown,{className:"h-4 w-4 mr-2"}),"Export Responses"]})]})})()]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,b.jsxs)(o.Card,{className:"h-40",children:[(0,b.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Attendees"}),(0,b.jsx)(g.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(o.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:E?(0,b.jsx)(m.Loader2,{className:"h-6 w-6 animate-spin"}):L.length})})]}),(0,b.jsxs)(o.Card,{className:"h-40",children:[(0,b.jsxs)(o.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(o.CardTitle,{className:"text-sm font-medium",children:"Total Responses"}),(0,b.jsx)(i,{className:"h-4 w-4 text-muted-foreground"})]}),(0,b.jsx)(o.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold",children:E?(0,b.jsx)(m.Loader2,{className:"h-6 w-6 animate-spin"}):y})})]}),(0,b.jsx)(o.Card,{className:"col-span-1 md:col-span-1 lg:col-span-1 h-40 p-0",children:(0,b.jsx)(o.CardContent,{children:(0,b.jsx)("div",{className:"h-[150px] flex items-center justify-center",children:E?(0,b.jsx)(m.Loader2,{className:"h-6 w-6 animate-spin"}):(A&&A.attendeeCount.length,(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No attendance data"}))})})}),(0,b.jsx)(o.Card,{className:"col-span-1 md:col-span-1 lg:col-span-1 p-0",children:(0,b.jsx)(o.CardContent,{children:(0,b.jsx)("div",{className:"h-[150px] flex items-center justify-center",children:E?(0,b.jsx)(m.Loader2,{className:"h-6 w-6 animate-spin"}):(A&&A.departmentBreakdown.length,(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"No department data"}))})})})]}),(0,b.jsx)(o.Card,{children:(0,b.jsxs)(o.CardContent,{children:[(0,b.jsxs)(p.Table,{children:[(0,b.jsx)(p.TableHeader,{children:(0,b.jsxs)(p.TableRow,{children:[(0,b.jsx)(p.TableHead,{children:"Name"}),(0,b.jsx)(p.TableHead,{children:"Department"}),(0,b.jsx)(p.TableHead,{children:"Check-in Time"})]})}),(0,b.jsx)(p.TableBody,{children:E?(0,b.jsx)(p.TableRow,{children:(0,b.jsx)(p.TableCell,{colSpan:3,className:"text-center py-8",children:(0,b.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,b.jsx)(m.Loader2,{className:"h-4 w-4 animate-spin"}),(0,b.jsx)("span",{className:"text-muted-foreground",children:"Loading attendance data..."})]})})}):O.length>0?O.map((a,c)=>{let d=new Date(a.createdOn).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return(0,b.jsxs)(p.TableRow,{children:[(0,b.jsx)(p.TableCell,{className:"font-medium",children:a.employeeName}),(0,b.jsx)(p.TableCell,{children:a.employeeDepartment}),(0,b.jsx)(p.TableCell,{children:d})]},`${a.employeeName}-${c}`)}):(0,b.jsx)(p.TableRow,{children:(0,b.jsx)(p.TableCell,{colSpan:3,className:"text-center py-8 text-muted-foreground",children:"No attendance records found"})})})]}),M>1&&(0,b.jsxs)("div",{className:"flex items-center justify-between space-x-2 py-4",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",N+1," to ",Math.min(N+5,L.length)," of ",L.length," attendees"]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>D(a=>Math.max(a-1,1)),disabled:1===C,children:"Previous"}),(0,b.jsx)("div",{className:"flex items-center space-x-1",children:Array.from({length:M},(a,b)=>b+1).map(a=>(0,b.jsx)(n.Button,{variant:C===a?"default":"outline",size:"sm",onClick:()=>D(a),className:"w-8 h-8 p-0",children:a},a))}),(0,b.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>D(a=>Math.min(a+1,M)),disabled:C===M,children:"Next"})]})]})]})}),(0,b.jsx)(v.QRCodeDialog,{isOpen:I,onClose:()=>J(!1),trainingId:a,trainingName:h?.trainingName})]}):(0,b.jsxs)("div",{className:"p-6",children:[(0,b.jsxs)(r.default,{href:"/trainings",className:"flex items-center text-sm text-muted-foreground mb-4 hover:underline",children:[(0,b.jsx)(j.default,{className:"h-4 w-4 mr-1"}),"Back to Trainings"]}),(0,b.jsx)("div",{className:"text-center py-8",children:(0,b.jsx)("p",{className:"text-muted-foreground",children:"Training not found"})})]})}(0,q.default)(async()=>{},{loadableGenerated:{modules:[76250]},ssr:!1}),(0,q.default)(async()=>{},{loadableGenerated:{modules:[39249]},ssr:!1})}];

//# sourceMappingURL=app_trainings_%5Bid%5D_page_tsx_798396dd._.js.map