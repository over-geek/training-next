(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,86311,e=>{"use strict";e.s(["MessageSquare",()=>t],86311);let t=(0,e.i(75254).default)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},31343,e=>{"use strict";e.s(["Play",()=>t],31343);let t=(0,e.i(75254).default)("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]])},67585,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"BailoutToCSR",{enumerable:!0,get:function(){return a}});let n=e.r(32061);function a(e){let{reason:t,children:s}=e;if("undefined"==typeof window)throw Object.defineProperty(new n.BailoutToCSRError(t),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return s}},9885,(e,t,s)=>{"use strict";function n(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"encodeURIPath",{enumerable:!0,get:function(){return n}})},52157,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"PreloadChunks",{enumerable:!0,get:function(){return l}});let n=e.r(43476),a=e.r(74080),r=e.r(63599),i=e.r(9885);function l(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let s=r.workAsyncStorage.getStore();if(void 0===s)return null;let l=[];if(s.reactLoadableManifest&&t){let e=s.reactLoadableManifest;for(let s of t){if(!e[s])continue;let t=e[s].files;l.push(...t)}}return 0===l.length?null:(0,n.jsx)(n.Fragment,{children:l.map(e=>{let t=s.assetPrefix+"/_next/"+(0,i.encodeURIPath)(e);return e.endsWith(".css")?(0,n.jsx)("link",{precedence:"dynamic",href:t,rel:"stylesheet",as:"style"},e):((0,a.preload)(t,{as:"script",fetchPriority:"low"}),null)})})}},69093,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return c}});let n=e.r(43476),a=e.r(71645),r=e.r(67585),i=e.r(52157);function l(e){return{default:e&&"default"in e?e.default:e}}let o={loader:()=>Promise.resolve(l(()=>null)),loading:null,ssr:!0},c=function(e){let t={...o,...e},s=(0,a.lazy)(()=>t.loader().then(l)),c=t.loading;function d(e){let l=c?(0,n.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,o=!t.ssr||!!t.loading,d=o?a.Suspense:a.Fragment,u=t.ssr?(0,n.jsxs)(n.Fragment,{children:["undefined"==typeof window?(0,n.jsx)(i.PreloadChunks,{moduleIds:t.modules}):null,(0,n.jsx)(s,{...e})]}):(0,n.jsx)(r.BailoutToCSR,{reason:"next/dynamic",children:(0,n.jsx)(s,{...e})});return(0,n.jsx)(d,{...o?{fallback:l}:{},children:u})}return d.displayName="LoadableComponent",d}},70703,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return a}});let n=e.r(55682)._(e.r(69093));function a(e,t){var s;let a={};"function"==typeof e&&(a.loader=e);let r={...a,...t};return(0,n.default)({...r,modules:null==(s=r.loadableGenerated)?void 0:s.modules})}("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),t.exports=s.default)},11275,e=>{"use strict";e.s(["default",()=>T],11275);var t=e.i(43476),s=e.i(71645),n=e.i(18566),a=e.i(27365),r=e.i(86311),i=e.i(61911),l=e.i(75254);let o=(0,l.default)("clipboard-check",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]]);var c=e.i(12012),c=c,d=e.i(31343);let u=(0,l.default)("square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var m=e.i(31278),h=e.i(67881),p=e.i(70065),x=e.i(47627),f=e.i(70703),g=e.i(22016),j=e.i(47911),y=e.i(99749),v=e.i(46696);let N=new class{connect(e,t,s){var n,a;if((null==(n=this.ws)?void 0:n.readyState)===WebSocket.OPEN)return void console.log("WebSocket already connected");this.trainingId=e,this.onAttendanceUpdate=t,this.onError=s;try{let e=this.getToken();if(!e)throw Error("No authentication token found");this.ws=new WebSocket("ws://localhost:8080/ws?token=".concat(e)),this.ws.onopen=()=>{console.log("WebSocket connection established"),this.reconnectAttempts=0,this.send({type:"PING"}),this.startHeartbeat(),v.toast.success("Connected to real-time attendance system")},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);this.handleMessage(t)}catch(e){console.error("Error processing WebSocket message:",e)}},this.ws.onclose=e=>{console.log("WebSocket connection closed",e.code,e.reason),this.stopHeartbeat(),1e3!==e.code&&this.reconnectAttempts<this.maxReconnectAttempts&&this.attemptReconnect()},this.ws.onerror=e=>{console.error("WebSocket error:",e),v.toast.error("Connection error. Attempting to reconnect...")}}catch(e){console.error("Failed to connect to WebSocket:",e),null==(a=this.onError)||a.call(this,"Failed to connect to attendance system")}}handleMessage(e){var t,s;switch(e.type){case"ATTENDANCE":if(e.data){let s={employeeName:e.data.name,employeeDepartment:e.data.department,createdOn:new Date().toISOString()};null==(t=this.onAttendanceUpdate)||t.call(this,s),v.toast.success("New Attendee: ".concat(s.employeeName),{description:"".concat(s.employeeDepartment," department")})}break;case"ERROR":null==(s=this.onError)||s.call(this,e.message||"Unknown error occurred"),v.toast.error("Attendance Error",{description:e.message||"Unknown error occurred"});break;case"PONG":break;default:console.log("Unhandled message type:",e.type)}}startHeartbeat(){this.heartbeatInterval=setInterval(()=>{var e;(null==(e=this.ws)?void 0:e.readyState)===WebSocket.OPEN&&this.send({type:"PING"})},15e3)}stopHeartbeat(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null)}attemptReconnect(){this.reconnectAttempts++,console.log("Attempting to reconnect (".concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),setTimeout(()=>{this.trainingId&&this.onAttendanceUpdate&&this.onError&&this.connect(this.trainingId,this.onAttendanceUpdate,this.onError)},this.reconnectDelay)}send(e){var t;(null==(t=this.ws)?void 0:t.readyState)===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}getToken(){let e=localStorage.getItem("auth_token")||localStorage.getItem("token");return e?e.replace("Bearer ",""):null}disconnect(){this.stopHeartbeat(),this.ws&&(this.ws.close(1e3,"Manual disconnect"),this.ws=null),this.trainingId=null,this.onAttendanceUpdate=null,this.onError=null,this.reconnectAttempts=0}isConnected(){var e;return(null==(e=this.ws)?void 0:e.readyState)===WebSocket.OPEN}constructor(){(0,y._)(this,"ws",null),(0,y._)(this,"reconnectAttempts",0),(0,y._)(this,"maxReconnectAttempts",5),(0,y._)(this,"reconnectDelay",3e3),(0,y._)(this,"heartbeatInterval",null),(0,y._)(this,"trainingId",null),(0,y._)(this,"onAttendanceUpdate",null),(0,y._)(this,"onError",null),window.addEventListener("beforeunload",()=>this.disconnect())}};var b=e.i(22448);let w=(0,f.default)(()=>e.A(42887),{loadableGenerated:{modules:[76250]},ssr:!1}),S=(0,f.default)(()=>e.A(89204),{loadableGenerated:{modules:[39249]},ssr:!1});function T(){let e=Number((0,n.useParams)().id),[l,f]=(0,s.useState)(null),[y,T]=(0,s.useState)(null),[k,C]=(0,s.useState)(0),[P,A]=(0,s.useState)(null),[O,R]=(0,s.useState)(1),[E,_]=(0,s.useState)(!0),[I,M]=(0,s.useState)(!1),[B,L]=(0,s.useState)(!1);(0,s.useEffect)(()=>(U(),()=>{N.disconnect()}),[e]),(0,s.useEffect)(()=>{(null==l?void 0:l.status)==="in-progress"?q():N.disconnect()},[null==l?void 0:l.status,e]);let U=async()=>{try{_(!0);let t=await j.TrainingService.getTrainingSessionById(e);f(t);let s=await j.TrainingService.getAttendanceLogs(e);T(s);let n=await j.TrainingService.getTrainingResponses(e);C(n.length);let a=await j.TrainingService.getTrainingMetrics(t.trainingName);A(a)}catch(e){console.error("Failed to fetch training data:",e),v.toast.error("Failed to load training details. Please try again.")}finally{_(!1)}},D=(null==y?void 0:y.attendees)||[],F=Math.ceil(D.length/5),H=(O-1)*5,W=D.slice(H,H+5),q=()=>{N.isConnected()||N.connect(e.toString(),z,G)},z=e=>{T(t=>t?t.attendees.some(t=>t.employeeName===e.employeeName)?t:{...t,attendees:[...t.attendees,{employeeName:e.employeeName,employeeDepartment:e.employeeDepartment,createdOn:e.createdOn}]}:t)},G=e=>{console.error("WebSocket error:",e),v.toast.error("Connection Error",{description:e})},J=async()=>{if(l)try{M(!0),await Promise.all([j.TrainingService.startTrainingSession(l.id),j.TrainingService.updateTrainingSession({id:l.id,status:"in-progress"})]),f(e=>e?{...e,status:"in-progress"}:null),v.toast.success("Training session started successfully!")}catch(t){var e;console.error("Failed to start training session:",t),console.error("Error details:",{message:null==t?void 0:t.message,status:null==t?void 0:t.status,response:null==t||null==(e=t.response)?void 0:e.data}),v.toast.error("Failed to start training session",{description:(null==t?void 0:t.message)||"Please try again."})}finally{M(!1)}},K=async()=>{if(l)try{M(!0),N.disconnect(),await Promise.all([j.TrainingService.endTrainingSession(l.id),j.TrainingService.updateTrainingSession({id:l.id,status:"done"})]),f(e=>e?{...e,status:"done"}:null),v.toast.success("Training session ended successfully!")}catch(t){var e;console.error("Failed to end training session:",t),console.error("Error details:",{message:null==t?void 0:t.message,status:null==t?void 0:t.status,response:null==t||null==(e=t.response)?void 0:e.data}),v.toast.error("Failed to end training session",{description:(null==t?void 0:t.message)||"Please try again."})}finally{M(!1)}},V=async()=>{if(l)try{await j.TrainingService.exportResponsesZIP(l.id),v.toast.success("Evaluation responses exported successfully!")}catch(e){console.error("Failed to export responses:",e),v.toast.error("Failed to export responses",{description:(null==e?void 0:e.message)||"Please try again."})}};return!l&&E?(0,t.jsx)("div",{className:"p-6 flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(m.Loader2,{className:"h-6 w-6 animate-spin"}),(0,t.jsx)("span",{className:"text-lg",children:"Loading training details..."})]})}):l?(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)(g.default,{href:"/trainings",className:"flex items-center text-sm text-muted-foreground mb-4 hover:underline",children:[(0,t.jsx)(c.default,{className:"h-4 w-4 mr-1"}),"Back to Trainings"]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"font-medium",children:"Agenda:"}),(0,t.jsx)("span",{children:l.trainingName})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("p",{className:"font-medium",children:"Facilitator:"}),(0,t.jsx)("span",{children:l.facilitator})]})]}),(()=>{if(!l)return null;let e=l.status;return"upcoming"===e?(0,t.jsxs)("div",{className:"space-x-2",children:[(0,t.jsxs)(h.Button,{variant:"outline",disabled:!0,children:[(0,t.jsx)(r.MessageSquare,{className:"h-4 w-4 mr-2"}),"Take Responses"]}),(0,t.jsxs)(h.Button,{onClick:J,disabled:I,children:[I?(0,t.jsx)(m.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,t.jsx)(d.Play,{className:"h-4 w-4 mr-2"}),"Start Session"]})]}):"in-progress"===e?(0,t.jsxs)("div",{className:"space-x-2",children:[(0,t.jsxs)(h.Button,{variant:"outline",onClick:()=>L(!0),children:[(0,t.jsx)(r.MessageSquare,{className:"h-4 w-4 mr-2"}),"Take Responses"]}),(0,t.jsxs)(h.Button,{onClick:K,disabled:I,children:[I?(0,t.jsx)(m.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,t.jsx)(u,{className:"h-4 w-4 mr-2"}),"End Session"]})]}):(0,t.jsxs)("div",{className:"space-x-2",children:[(0,t.jsxs)(h.Button,{variant:"outline",onClick:()=>L(!0),children:[(0,t.jsx)(r.MessageSquare,{className:"h-4 w-4 mr-2"}),"Take Responses"]}),(0,t.jsxs)(h.Button,{onClick:V,children:[(0,t.jsx)(a.FileDown,{className:"h-4 w-4 mr-2"}),"Export Responses"]})]})})()]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)(p.Card,{className:"h-40",children:[(0,t.jsxs)(p.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(p.CardTitle,{className:"text-sm font-medium",children:"Total Attendees"}),(0,t.jsx)(i.Users,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsx)(p.CardContent,{children:(0,t.jsx)("div",{className:"text-2xl font-bold",children:E?(0,t.jsx)(m.Loader2,{className:"h-6 w-6 animate-spin"}):D.length})})]}),(0,t.jsxs)(p.Card,{className:"h-40",children:[(0,t.jsxs)(p.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(p.CardTitle,{className:"text-sm font-medium",children:"Total Responses"}),(0,t.jsx)(o,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsx)(p.CardContent,{children:(0,t.jsx)("div",{className:"text-2xl font-bold",children:E?(0,t.jsx)(m.Loader2,{className:"h-6 w-6 animate-spin"}):k})})]}),(0,t.jsx)(p.Card,{className:"col-span-1 md:col-span-1 lg:col-span-1 h-40 p-0",children:(0,t.jsx)(p.CardContent,{children:(0,t.jsx)("div",{className:"h-[150px] flex items-center justify-center",children:E?(0,t.jsx)(m.Loader2,{className:"h-6 w-6 animate-spin"}):P&&P.attendeeCount.length>0&&1?(0,t.jsx)(w,{data:P,title:"Attendance Rate Over Time"}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No attendance data"})})})}),(0,t.jsx)(p.Card,{className:"col-span-1 md:col-span-1 lg:col-span-1 p-0",children:(0,t.jsx)(p.CardContent,{children:(0,t.jsx)("div",{className:"h-[150px] flex items-center justify-center",children:E?(0,t.jsx)(m.Loader2,{className:"h-6 w-6 animate-spin"}):P&&P.departmentBreakdown.length>0&&1?(0,t.jsx)(S,{data:P}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"No department data"})})})})]}),(0,t.jsx)(p.Card,{children:(0,t.jsxs)(p.CardContent,{children:[(0,t.jsxs)(x.Table,{children:[(0,t.jsx)(x.TableHeader,{children:(0,t.jsxs)(x.TableRow,{children:[(0,t.jsx)(x.TableHead,{children:"Name"}),(0,t.jsx)(x.TableHead,{children:"Department"}),(0,t.jsx)(x.TableHead,{children:"Check-in Time"})]})}),(0,t.jsx)(x.TableBody,{children:E?(0,t.jsx)(x.TableRow,{children:(0,t.jsx)(x.TableCell,{colSpan:3,className:"text-center py-8",children:(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,t.jsx)(m.Loader2,{className:"h-4 w-4 animate-spin"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:"Loading attendance data..."})]})})}):W.length>0?W.map((e,s)=>{let n=new Date(e.createdOn).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return(0,t.jsxs)(x.TableRow,{children:[(0,t.jsx)(x.TableCell,{className:"font-medium",children:e.employeeName}),(0,t.jsx)(x.TableCell,{children:e.employeeDepartment}),(0,t.jsx)(x.TableCell,{children:n})]},"".concat(e.employeeName,"-").concat(s))}):(0,t.jsx)(x.TableRow,{children:(0,t.jsx)(x.TableCell,{colSpan:3,className:"text-center py-8 text-muted-foreground",children:"No attendance records found"})})})]}),F>1&&(0,t.jsxs)("div",{className:"flex items-center justify-between space-x-2 py-4",children:[(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:["Showing ",H+1," to ",Math.min(H+5,D.length)," of ",D.length," attendees"]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>R(e=>Math.max(e-1,1)),disabled:1===O,children:"Previous"}),(0,t.jsx)("div",{className:"flex items-center space-x-1",children:Array.from({length:F},(e,t)=>t+1).map(e=>(0,t.jsx)(h.Button,{variant:O===e?"default":"outline",size:"sm",onClick:()=>R(e),className:"w-8 h-8 p-0",children:e},e))}),(0,t.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>R(e=>Math.min(e+1,F)),disabled:O===F,children:"Next"})]})]})]})}),(0,t.jsx)(b.QRCodeDialog,{isOpen:B,onClose:()=>L(!1),trainingId:e,trainingName:null==l?void 0:l.trainingName})]}):(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)(g.default,{href:"/trainings",className:"flex items-center text-sm text-muted-foreground mb-4 hover:underline",children:[(0,t.jsx)(c.default,{className:"h-4 w-4 mr-1"}),"Back to Trainings"]}),(0,t.jsx)("div",{className:"text-center py-8",children:(0,t.jsx)("p",{className:"text-muted-foreground",children:"Training not found"})})]})}},42887,e=>{e.v(t=>Promise.all(["static/chunks/42270f59ab60c4f2.js","static/chunks/8d203776041e44f7.js"].map(t=>e.l(t))).then(()=>t(76250)))},89204,e=>{e.v(t=>Promise.all(["static/chunks/8ac69e3e3977e5ae.js","static/chunks/8d203776041e44f7.js"].map(t=>e.l(t))).then(()=>t(39249)))}]);